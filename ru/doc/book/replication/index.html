






















<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google-site-verification" content="CR40jzpLISkiUAw2MrH2zHSDNVmzyK88Nj7Crmx_RxQ" />
    
  <link rel="icon" type="image/png" sizes="16x16" href=../../../_static/favicon/favicon-16x16.png>
  <link rel="icon" type="image/png" sizes="32x32" href=../../../_static/favicon/favicon-32x32.png>
  <link rel="icon" type="image/png" sizes="96x96" href=../../../_static/favicon/favicon-96x96.png>

    <title>6. Репликация</title>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>
      <script type="text/javascript" src="../../../_static/searchtools.js"></script>
      <script type="text/javascript" src="../../../_static/js/menu.js"></script>
      <script type="text/javascript" src="../../../_static/js/mobile_menu.js"></script>
      <script type="text/javascript" src="../../../_static/js/stacktable.min.js"></script>
      <script type="text/javascript" src="../../../_static/js/headers.js"></script>
      <script type="text/javascript" src="../../../_static/js/dropdown.js"></script>
      <script type="text/javascript" src="../../../_static/js/jquery.sticky-kit.min.js"></script>
      <link rel="stylesheet" href="../../../_static/design.css">

    
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.3',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          this.page.identifier = "doc/book/replication/index";
          this.language        = "ru"
      };
      window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = []; t.ready = function(f) { t._e.push(f); };
        return t;
      }(document, "script", "twitter-wjs"));
    </script>
    

  </head>
  <body class="p-cols_design b-doc-doc_book_replication_index">
    <div class="b-wrapper">
      <!-- HEADER > -->
      
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search"
            action="../../../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../../index.html" class="b-menu-item-url">Main</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item p-cloud">
      
        <a href="https://tarantool.io/" class="b-menu-item-url">Cloud</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
  </ul>

          
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../../../en/doc/book/replication/index.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>

        </nav>
      </div>
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        <div class="b-header_menu-top">
          
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../../index.html" class="b-menu-item-url">Main</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item p-cloud">
      
        <a href="https://tarantool.io/" class="b-menu-item-url">Cloud</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
  </ul>

          <div class="b-header_menu-top-ctl">
            
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../../../en/doc/book/replication/index.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>

            <a class="b-search-btn" href="#">
              <i class="fa fa-search"></i>
            </a>
          </div>
        </div>
        <div class="b-header_menu-bottom">
          <form role="search" class="b-header_menu-search" action="../../../search.html" method="get">
            <input name="q" type="search" class="b-header_menu-search-text"
                   placeholder="Search Tarantool.org web site and documentation">
            <input class="b-header_menu-search-but" type="submit" value="Go">
          </form>
        </div>
      </nav>
    </div>
  </header>

      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  
    <section class="b-block-lightgray b-documentation_top b-clearbox p-documentation_in">
      <div class="b-block-wrapper">
        <h2 class="b-section-title b-ellipsis toggle-navigation" title="6. Репликация"> 6. Репликация </h2>
      </div>
    </section>
    
      <div class="b-cols_content b-clearbox">
        <div class="b-cols_content_left">
          <div class="b-menu-toc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../whats_new.html">Что нового?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../whats_new.html#what-s-new-in-tarantool-1-7">Что нового в Tarantool 1.7?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Общие сведения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#an-application-server-together-with-a-database-manager">Сервер приложений + СУБД</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#database-features">Возможности СУБД</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Руководство пользователя</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">1. Предисловие</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro.html#how-to-read-the-documentation">1.1. Как пользоваться документацией</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro.html#getting-in-touch-with-the-tarantool-community">1.2. Как связаться с сообществом разработчиков Tarantool&#8217;а</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide_getting_started.html">2. Начало работы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Скачивание и установка бинарного пакета</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Первичный запуск Tarantool&#8217;а и создание базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide_getting_started.html#connecting-remotely">2.3. Установка удаленного соединения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../box/index.html">3. Функционал СУБД</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../box/data_model.html">3.1. Модель данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#space">3.1.1. Пространство</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#tuple">3.1.2. Tuple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#index">3.1.3. Индекс</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#data-types">3.1.4. Типы данных</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/data_model.html#lua-vs-msgpack">3.1.4.1. Lua vs MsgPack</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/data_model.html#indexed-field-types">3.1.4.2. Indexed field types</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#persistence">3.1.5. Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/data_model.html#operations">3.1.6. Операции</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/data_model.html#data-operations">3.1.6.1. Data operations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/data_model.html#index-operations">3.1.6.2. Операции с индексами</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/data_model.html#complexity-factors">3.1.6.3. Complexity factors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/atomic.html">3.2. Контроль транзакций</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/atomic.html#threads-fibers-and-yields">3.2.1. Threads, fibers and yields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/atomic.html#cooperative-multitasking">3.2.2. Cooperative multitasking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/atomic.html#transactions">3.2.3. Transactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/atomic.html#implicit-yields">3.2.4. Implicit yields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/authentication.html">3.3. Ограничение доступа</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html#users">3.3.1. Users</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html#passwords">3.3.2. Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html#owners-and-privileges">3.3.3. Owners and privileges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html#roles">3.3.4. Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/authentication.html#sessions-and-security">3.3.5. Sessions and security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../box/triggers.html">3.4. Триггеры</a></li>
<li class="toctree-l3"><a class="reference internal" href="../box/limitations.html">3.5. Ограничения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_server.html">4. Сервер приложений</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#about-modules-rocks">4.1. Про модули/rocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#installing-an-existing-module">4.2. Установка существующего модуля</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#creating-a-new-lua-module-locally">4.3. Создание нового модуля на языке Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#creating-a-new-c-c-module-locally">4.4. Создание нового модуля на языке C/C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#creating-a-mixed-lua-c-module-locally">4.5. Создание нового модуля на смеси языков Lua/C</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#tips-for-special-situations">4.6. Примечания для особых случаев</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#tips-on-lua-syntax">4.7. Tips on Lua syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app_server.html#cookbook-recipes">4.8. Книга рецептов</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#hello-world-lua">4.8.1. hello_world.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#console-start-lua">4.8.2. console_start.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#fio-read-lua">4.8.3. fio_read.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#fio-write-lua">4.8.4. fio_write.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#ffi-printf-lua">4.8.5. ffi_printf.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#ffi-gettimeofday-lua">4.8.6. ffi_gettimeofday.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#ffi-zlib-lua">4.8.7. ffi_zlib.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#ffi-meta-lua">4.8.8. ffi_meta.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#print-arrays-lua">4.8.9. print_arrays.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#count-array-lua">4.8.10. count_array.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#count-array-with-nils-lua">4.8.11. count_array_with_nils.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#count-array-with-nulls-lua">4.8.12. count_array_with_nulls.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#count-map-lua">4.8.13. count_map.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#swap-lua">4.8.14. swap.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#uri-lua">4.8.15. uri.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#class-lua">4.8.16. class.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#garbage-lua">4.8.17. garbage.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#fiber-producer-and-consumer-lua">4.8.18. fiber_producer_and_consumer.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#socket-tcpconnect-lua">4.8.19. socket_tcpconnect.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#socket-tcp-echo-lua">4.8.20. socket_tcp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#getaddrinfo-lua">4.8.21. getaddrinfo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#socket-udp-echo-lua">4.8.22. socket_udp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#http-get-lua">4.8.23. http_get.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#http-send-lua">4.8.24. http_send.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#http-server-lua">4.8.25. http_server.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../app_server.html#http-generate-html-lua">4.8.26. http_generate_html.lua</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../administration.html">5. Администрирование серверной части</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#using-tarantool-as-a-client">5.1. Using Tarantool as a client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#conventions-used-in-this-section">5.1.1. Условные обозначения, используемые в этом разделе</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#options-when-starting-client-from-the-command-line">5.1.2. Параметры запуска клиента из командной строки</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#tokens-requests-and-special-key-combinations">5.1.3. Токены, запросы и специальные комбинации клавиш</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#requests">5.1.4. Запросы</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#utility-tarantoolctl">5.2. Утилита tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#configuration-for-tarantoolctl">5.2.1. Конфигурирование tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#commands-for-tarantoolctl">5.2.2. Команды для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#typical-code-snippets-for-tarantoolctl">5.2.3. Примеры кода для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#a-detailed-example-for-tarantoolctl">5.2.4. Подробный пример для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#an-example-for-tarantoolctl-connect">5.2.5. An example for tarantoolctl connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#administrative-ports">5.3. Служебные порты</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#administrative-requests">5.4. Служебные запросы</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#server-introspection">5.5. Просмотр состояния сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#backups">5.6. Резервное копирование</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#cold-backup">5.6.1. Cold backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#continuous-remote-backup">5.6.2. Continuous remote backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#hot-backup">5.6.3. Hot backup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#updates-upgrades">5.7. Обновление сервера и базы данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#updating-tarantool-in-production">5.7.1. Обновление Tarantool&#8217;а в условиях эксплуатации</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#upgrading-a-tarantool-database">5.7.2. Upgrading a Tarantool database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#server-signal-handling">5.8. Обработка сигналов от сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#generating-a-core-file">5.9. Generating a core file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#process-title">5.10. Название процесса</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#system-specific-administration-notes">5.11. Заметки по администрированию для разных платформ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#debian-gnu-linux-and-ubuntu">5.11.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#fedora-rhel-centos">5.11.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#freebsd">5.11.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#mac-os-x">5.11.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../administration.html#notes-for-systemd-users">5.12. Заметки для пользователей systemd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#instance-management">5.12.1. Управление экземплярами</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#creating-instances">5.12.1.1. Создание экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#starting-instances">5.12.1.2. Запуск экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#monitoring-instances">5.12.1.3. Мониторинг экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#attaching-to-instances">5.12.1.4. Подсоединение к экземплярам</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#checking-logs">5.12.1.5. Проверка журнала</a></li>
<li class="toctree-l5"><a class="reference internal" href="../administration.html#stopping-instances">5.12.1.6. Остановка экземпляров</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#daemon-supervision">5.12.2. Контроль за фоновыми программами</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#customizing-the-service-file">5.12.3. Правка настроек сервисного файла</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#debugging">5.12.4. Отладка</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#precautions">5.12.5. Особые указания</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#limitations">5.12.6. Ограничения</a></li>
<li class="toctree-l4"><a class="reference internal" href="../administration.html#sysvinit-systemd-conversion">5.12.7. sysvinit -&gt; systemd conversion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. Репликация</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#replication-architecture">6.1. Архитектура механизма репликации</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-master">6.2. Setting up a master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-replica">6.3. Настройка сервера-реплики</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recovering-from-a-degraded-state">6.4. Восстановление после сбоя</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quick-startup-of-a-new-simple-two-server-cluster">6.5. Quick startup of a new simple two-server cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-a-replica-s-actions">6.6. Мониторинг действий реплики</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preventing-duplicate-actions">6.7. Предотвращение дублирующихся действий</a></li>
<li class="toctree-l3"><a class="reference internal" href="#master-master-replication">6.8. Репликация по схеме master-master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#all-the-what-if-questions">6.9. Ответы на вопросы &#8220;Что если?&#8221;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hands-on-replication-tutorial">6.10. Практическое руководство по репликации</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../connectors/index.html">7. Коннекторы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#protocol">7.1. Протокол</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#packet-example">7.2. Пример пакета данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#setting-up-the-server-for-connector-examples">7.3. Настройка окружения для примеров работы с коннекторами</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#java">7.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#go">7.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#r">7.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#erlang">7.7. Erlang</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#perl">7.8. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#php">7.9. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#python">7.10. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#node-js">7.11. Node.js</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#c">7.12. C#</a></li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#id1">7.13. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../connectors/index.html#example-1">7.13.1. Пример 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../connectors/index.html#example-2">7.13.2. Пример 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../connectors/index.html#interpreting-function-return-values">7.14. Интерпретация возвращаемых значений</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html">8. Вопросы и ответы</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Справочники</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/reference_lua/index.html">1. Справочник по встроенной библиотеке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/box.html">1.1. Модуль <cite>box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../box/box_cfg.html">1.1.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_index.html">1.1.2. Вложенный модуль <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#example-showing-use-of-the-box-functions">1.1.2.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#example-showing-a-user-defined-iterator">1.1.2.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">1.1.2.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_info.html">1.1.3. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/box_once.html">1.1.4. Функция <cite>box.once</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_schema.html">1.1.5. Вложенный модуль <cite>box.schema</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_session.html">1.1.6. Вложенный модуль <cite>box.session</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_slab.html">1.1.7. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_space.html">1.1.8. Вложенный модуль <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-read-space-tuples">1.1.8.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="../box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">1.1.8.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_stat.html">1.1.9. Submodule <cite>box.stat</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_tuple.html">1.1.10. Вложенный модуль <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../box/box_tuple.html#example">1.1.10.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../box/box_txn_management.html">1.1.11. Functions for transaction management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/clock.html">1.2. Модуль <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/console.html">1.3. Модуль <cite>console</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/crypto.html">1.4. Модуль <cite>crypto</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/crypto.html#incremental-methods-in-the-crypto-module">1.4.1. Incremental methods in the crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">1.4.2. Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/csv.html">1.5. Module <cite>csv</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/digest.html">1.6. Модуль <cite>digest</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/digest.html#incremental-methods-in-the-digest-module">1.6.1. Incremental methods in the digest module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/digest.html#example">1.6.2. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/errno.html">1.7. Module <cite>errno</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/box_error.html">1.8. Вложенный модуль <cite>box.error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/fiber.html">1.9. Модуль <cite>fiber</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/fiber.html#example-of-fiber-use">1.9.1. Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/fiber_ipc.html">1.10. Модуль <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/fiber_ipc.html#channel">1.10.1. Channel</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_lua/fiber_ipc.html#example">1.10.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/fiber_ipc.html#condition-variables">1.10.2. Condition variables</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_lua/fiber_ipc.html#id1">1.10.2.1. Пример</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/fio.html">1.11. Module <cite>fio</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/fio.html#common-pathname-manipulations">1.11.1. Common pathname manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/fio.html#common-file-manipulations">1.11.2. Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/fun.html">1.12. Module <cite>fun</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/json.html">1.13. Module <cite>json</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/json.html#configuration-settings">1.13.1. Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/log.html">1.14. Module <cite>log</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/log.html#example">1.14.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/msgpack.html">1.15. Модуль <cite>msgpack</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/msgpack.html#example">1.15.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/net_box.html">1.16. Модуль <cite>net.box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/net_box.html#example">1.16.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/pickle.html">1.17. Модуль <cite>pickle</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/socket.html">1.18. Модуль <cite>socket</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/socket.html#examples">1.18.1. Примеры:</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">1.18.1.1. Use of a TCP socket over the Internet</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_lua/socket.html#use-of-a-udp-socket-on-localhost">1.18.1.2. Use of a UDP socket on localhost</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">1.18.1.3. Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/strict.html">1.19. Модуль <cite>strict</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/tap.html">1.20. Module <cite>tap</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/tap.html#example">1.20.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/tarantool.html">1.21. Модуль <cite>tarantool</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/uuid.html">1.22. Module <cite>uuid</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/uuid.html#example">1.22.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/xlog.html">1.23. Module <cite>xlog</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/yaml.html">1.24. Module <cite>yaml</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_lua/yaml.html#example">1.24.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/other.html">1.25. Разное</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/errcodes.html">1.26. Коды ошибок от базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_lua/errcodes.html#handling-errors">1.27. Handling errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/reference_rock/index.html">2. Справочник по сторонним библиотекам</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_rock/dbms.html">2.1. SQL DBMS Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/dbms.html#mysql-example">2.1.1. MySQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#installation">2.1.1.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../reference/reference_rock/dbms.html#with-luarocks">2.1.1.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/reference_rock/dbms.html#with-github">2.1.1.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#connecting">2.1.1.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#how-to-ping">2.1.1.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#executing-a-statement">2.1.1.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#closing-connection">2.1.1.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#example">2.1.1.6. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/dbms.html#postgresql-example">2.1.2. PostgreSQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id1">2.1.2.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id2">2.1.2.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id3">2.1.2.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id4">2.1.2.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id5">2.1.2.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id6">2.1.2.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id7">2.1.2.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/reference_rock/dbms.html#id8">2.1.2.6. Пример</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_rock/expirationd.html">2.2. Модуль <cite>expirationd</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_rock/shard.html">2.3. Модуль <cite>shard</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/shard.html#example-shard-init-syntax-for-one-shard">2.3.1. Example: shard.init syntax for one shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/shard.html#example-shard-init-syntax-for-three-shards">2.3.2. Example: shard.init syntax for three shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/shard.html#example-shard-minimal-configuration">2.3.3. Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/shard.html#example-shard-scaling-out">2.3.4. Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/reference_rock/tdb.html">2.4. Module <cite>tdb</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/tdb.html#debugger-commands">2.4.1. Debugger Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/reference_rock/tdb.html#example-session">2.4.2. Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/configuration/index.html">3. Справочник по настройке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/configuration/index.html#command-options">3.1. Опции комнандной строки</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/configuration/index.html#uri">3.2. Универсальный код ресурса (URI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/configuration/index.html#initialization-file">3.3. Файл инициализации</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/configuration/index.html#configuration-parameters">3.4. Параметры конфигурации</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#basic-parameters">3.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#configuring-the-storage">3.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#snapshot-daemon">3.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#binary-logging-and-snapshots">3.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#hot-standby">3.4.5. Hot standby</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#replication">3.4.6. Репликация</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#networking">3.4.7. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/configuration/index.html#logging">3.4.8. Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Практикум</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/lua_tutorials.html">1. Практические задания на Lua</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/lua_tutorials.html#insert-one-million-tuples-with-a-lua-stored-procedure">1.1. Вставка 1 млн кортежей с помощью хранимой процедуры на языке Lua</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#configure">1.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#delimiter">1.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#create-a-function-that-returns-a-string">1.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#create-a-function-that-calls-another-function-and-sets-a-variable">1.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-one-letter-random-string">1.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-ten-letter-random-string">1.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#make-a-tuple-out-of-a-number-and-a-string">1.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-tuple-into-the-database">1.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-million-tuples-into-the-database">1.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/lua_tutorials.html#sum-a-json-field-for-all-tuples">1.2. Подсчет суммы по JSON-полям во всех кортежах</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/lua_tutorials.html#indexed-pattern-search">1.3. Индексированный поиск по шаблонам</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/c_tutorial.html">2. Практическое задание на C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/c_tutorial.html#c-stored-procedures">2.1. Хранимые процедуры на языке C</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributor&#8217;s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/reference_capi/index.html">1. Справочник по C API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/box.html">1.1. Модуль <cite>box</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/clock.html">1.2. Модуль <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/coio.html">1.3. Модуль <cite>coio</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/error.html">1.4. Модуль <cite>error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/fiber.html">1.5. Модуль <cite>fiber</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/box_index.html">1.6. Модуль <cite>index</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/latch.html">1.7. Модуль <cite>latch</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/utils.html">1.8. Модуль <cite>lua/utils</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/say.html">1.9. Модуль <cite>say</cite> (логирование)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/schema.html">1.10. Модуль <cite>schema</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/trivia.html">1.11. Модуль <cite>trivia/config</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/tuple.html">1.12. Модуль <cite>tuple</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/reference_capi/txn.html">1.13. Модуль <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/internals_index.html">2. Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/internals_index.html#tarantool-s-binary-protocol">2.1. Tarantool&#8217;s binary protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#notation-in-diagrams">2.1.1. Notation in diagrams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#greeting-packet">2.1.2. Greeting packet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#unified-packet-structure">2.1.3. Unified packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#authentication">2.1.4. Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#requests">2.1.5. Запросы</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#response-packet-structure">2.1.6. Response packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#replication-packet-structure">2.1.7. Replication packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/internals_index.html#xlog-snap">2.1.8. XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/internals_index.html#data-persistence-and-the-wal-file-format">2.2. Data persistence and the WAL file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/internals_index.html#the-snapshot-file-format">2.3. The snapshot file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/internals_index.html#the-recovery-process">2.4. The recovery process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/internals_index.html#server-startup-with-replication">2.5. Server startup with replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/build_contribute_index.html">3. Build and contribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/building_from_source.html">3.1. Building from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/building_documentation.html">3.2. Building documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/release_management.html">3.3. Release management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/release_management.html#how-to-make-a-minor-release">3.3.1. How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev_guide/guidelines_index.html">4. Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/developer_guidelines.html">4.1. Developer guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/developer_guidelines.html#how-to-work-on-a-bug">4.1.1. How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html">4.2. Documentation guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#markup-issues">4.2.1. Markup issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#wrapping-text">4.2.1.1. Wrapping text</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#formatting-code-snippets">4.2.1.2. Formatting code snippets</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#using-separated-links">4.2.1.3. Using separated links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#creating-labels-for-local-links">4.2.1.4. Creating labels for local links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#making-comments">4.2.1.5. Making comments</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#language-and-style-issues">4.2.2. Language and style issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#us-vs-british-spelling">4.2.2.1. US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#examples-and-templates">4.2.3. Examples and templates</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#module-and-function">4.2.3.1. Module and function</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/documentation_guidelines.html#module-class-and-method">4.2.3.2. Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/c_style_guide.html">4.3. C Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#general-guidelines">4.3.1. General guidelines</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#commenting-style">4.3.1.1. Commenting style</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#header-files">4.3.1.2. Header files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#allocating-memory">4.3.1.3. Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#other">4.3.1.4. Other</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/c_style_guide.html#linux-kernel-coding-style">4.3.2. Linux kernel coding style</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-1-indentation">4.3.2.1. Chapter 1: Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-2-breaking-long-lines-and-strings">4.3.2.2. Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-3-placing-braces-and-spaces">4.3.2.3. Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-3-1-spaces">4.3.2.4. Chapter 3.1:  Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-4-naming">4.3.2.5. Chapter 4: Naming</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-5-typedefs">4.3.2.6. Chapter 5: Typedefs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-6-functions">4.3.2.7. Chapter 6: Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-7-centralized-exiting-of-functions">4.3.2.8. Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-8-commenting">4.3.2.9. Chapter 8: Commenting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-9-you-ve-made-a-mess-of-it">4.3.2.10. Chapter 9: You&#8217;ve made a mess of it</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-10-kconfig-configuration-files">4.3.2.11. Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-11-data-structures">4.3.2.12. Chapter 11: Data structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-12-macros-enums-and-rtl">4.3.2.13. Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-13-printing-kernel-messages">4.3.2.14. Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-14-allocating-memory">4.3.2.15. Chapter 14: Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-15-the-inline-disease">4.3.2.16. Chapter 15: The inline disease</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-16-function-return-values-and-names">4.3.2.17. Chapter 16: Function return values and names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-17-don-t-re-invent-the-kernel-macros">4.3.2.18. Chapter 17:  Don&#8217;t re-invent the kernel macros</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#chapter-18-editor-modelines-and-other-cruft">4.3.2.19. Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/c_style_guide.html#appendix-i-references">4.3.2.20. Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev_guide/python_style_guide.html">4.4. Python Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#introduction">4.4.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">4.4.2. A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#code-lay-out">4.4.3. Code lay-out</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#indentation">4.4.3.1. Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#tabs-or-spaces">4.4.3.2. Tabs or Spaces?</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#maximum-line-length">4.4.3.3. Maximum Line Length</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#blank-lines">4.4.3.4. Blank Lines</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#encodings-pep-263">4.4.3.5. Encodings (PEP 263)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#imports">4.4.3.6. Imports</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#whitespace-in-expressions-and-statements">4.4.4. Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#pet-peeves">4.4.4.1. Pet Peeves</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#other-recommendations">4.4.4.2. Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#comments">4.4.5. Comments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#block-comments">4.4.5.1. Block Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#inline-comments">4.4.5.2. Inline Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#documentation-strings">4.4.5.3. Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#version-bookkeeping">4.4.6. Version Bookkeeping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#naming-conventions">4.4.7. Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#descriptive-naming-styles">4.4.7.1. Descriptive: Naming Styles</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../dev_guide/python_style_guide.html#prescriptive-naming-conventions">4.4.7.2. Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#names-to-avoid">4.4.7.2.1. Names to Avoid</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#package-and-module-names">4.4.7.2.2. Package and Module Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#class-names">4.4.7.2.3. Class Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#exception-names">4.4.7.2.4. Exception Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#global-variable-names">4.4.7.2.5. Global Variable Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#function-names">4.4.7.2.6. Function Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#function-and-method-arguments">4.4.7.2.7. Function and method arguments</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#method-names-and-instance-variables">4.4.7.2.8. Method Names and Instance Variables</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#constants">4.4.7.2.9. Constants</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../dev_guide/python_style_guide.html#designing-for-inheritance">4.4.7.2.10. Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#references">4.4.8. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dev_guide/python_style_guide.html#copyright">4.4.9. Copyright</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
        <div class="b-cols_content_right">
          <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="../index.html"
             class="b-path-list-item-url b-ellipsis">
            Руководство пользователя
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="6. Репликация" class="b-path_current b-ellipsis">
          6. Репликация
        </div>
      </li>
      
    </ul>
  </div>

  <article class="b-article">
    
    
      <div class="admonition note">
        <p class="first admonition-title">Замечание</p>
        <p class="last">
          Документация находится в процессе перевода и может
          отставать от Английской версии
        </p>
      </div>
    
    <div class="section" id="replication">
<span id="index-box-replication"></span><h1>6. Репликация<a class="headerlink" href="#replication" title="Ссылка на этот заголовок">¶</a></h1>
<p>Механизм репликации позволяет сразу многим Tarantool-серверам работать с копиями одних и тех же баз данных. При этом все базы остаются в синхронизированном состоянии благодаря тому, что каждый сервер может сообщать другим серверам о совершенных им изменениях. Сервера, которые работают над одними и теми же базами, представляют собой &#8220;кластер&#8221;. У каждого сервера в кластере есть числовой идентификатор (server id), уникальный в рамках кластера.</p>
<p>Чтобы настроить репликацию, необходимо настроить главные сервера (master), которые первыми обрабатывают запросы на изменение данных, затем настроить сервера-реплики (replica), которые копируют к себе запросы на изменение данных с главных серверов, и прописать процедуры для восстановления после сбоя.</p>
<div class="section" id="replication-architecture">
<h2>6.1. Архитектура механизма репликации<a class="headerlink" href="#replication-architecture" title="Ссылка на этот заголовок">¶</a></h2>
<p>Чтобы знать о всех изменениях на стороне главного сервера, каждая реплика непрерывно опрашивает главный сервер на предмет обновлений в его WAL-файле (write ahead log) и применяет эти обновления на своей стороне. Каждая запись в WAL-файле представляет собой один запрос на изменение данных (например, INSERT, UPDATE или DELETE) и присвоенный данной записи номер (LSN = log sequence number). Номера присваиваются в порядке возрастания. По сути, репликация в Tarantool&#8217;е является построчной: все команды на изменение данных полностью детерминированы, и каждая такая команда относится только к одному кортежу.</p>
<p>Вызовы хранимых Lua-процедур фиксируются не в WAL-файле, а в журнале событий (event log). Таким образом гарантируется, что не детерминированное поведение логики на Lua не приведет к рассинхронизации реплицированных данных.</p>
</div>
<div class="section" id="setting-up-a-master">
<h2>6.2. Setting up a master<a class="headerlink" href="#setting-up-a-master" title="Ссылка на этот заголовок">¶</a></h2>
<p>Чтобы настроить возможность установки соединения для реплик, на стороне главного сервера требуется лишь указать значение для параметра &#8220;<a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-listen"><span class="std std-ref">listen</span></a>&#8221; в init-запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. Например, <code class="docutils literal"><span class="pre">box.cfg{listen=3301}</span></code>. Когда URI для прослушивания задан, главный сервер готов принимать запросы на соединение от любого количества реплик. Каждая реплика при этом находится в некотором <a class="reference internal" href="#index-monitoring-replica-actions"><span class="std std-ref">статусе репликации</span></a>.</p>
</div>
<div class="section" id="setting-up-a-replica">
<h2>6.3. Настройка сервера-реплики<a class="headerlink" href="#setting-up-a-replica" title="Ссылка на этот заголовок">¶</a></h2>
<p>Каждому Tarantool-серверу необходим корректный файл со статическим снимком данных (.snap-файл). Файл-снимок создается на сервере при первом запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. Если при первом таком запросе на сервере не определен источник репликации (replication source), то сервер стартует в режиме главного сервера и создает для себя новый кластер с новым уникальными UUID. Если же источник репликации при первом <code class="docutils literal"><span class="pre">box.cfg</span></code>-запросе определен, то сервер стартует в режиме реплики, а файл-снимок и информация о кластере берутся из WAL-файлов на главном сервере. Поэтому при настройке репликации нужно указать параметр <a class="reference internal" href="../../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> в запросе <code class="docutils literal"><span class="pre">box.cfg</span></code>. При первом соединении с главным сервером сервер-реплика включается в состав кластера. В дальнейшем такая реплика общается только с главным сервером из данного кластера.</p>
<p>После установки соединения с главным сервером реплика запрашивает у него все изменения, чьи LSN-номера в WAL-файле больше номера последнего локального изменения на реплике. Поэтому WAL-файлы на главном сервере нужно хранить до тех пор, пока все реплики не применят изменения из этих WAL-файлов на своей стороне. Состояние реплики можно &#8220;обнулить&#8221;, удалив все файлы репликации (.snap-файл со снимком и .xlog-файлы с записями WAL) и запустив сервер снова. Реплика при этом возьмет все кортежи с главного сервера и придет в синхронизированное состояние. Обратите внимание, что такая процедура &#8220;обнуления&#8221; сработает, только если на главном сервере будут доступны все нужные WAL-файлы.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Параметры репликации можно менять на лету, что позволяет назначать реплику на роль главного сервера и наоборот. Для этого используется запрос <a class="reference internal" href="../box/box_cfg.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Реплика не берет настройки конфигурации с главного сервера, например настройки запуска <a class="reference internal" href="../../reference/configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">фоновой программы для работы со снимками</span></a> на главном сервере. Чтобы получить те же настройки на реплике, нужно задать их явным образом.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Replication requires privileges. Privileges for accessing spaces could be
granted directly to the user who will start the replica. However, it is more
usual to grant privileges for accessing spaces to a
<a class="reference internal" href="../box/authentication.html#authentication-roles"><span class="std std-ref">role</span></a>, and then grant the role to the user
who will start the replica.</p>
</div>
</div>
<div class="section" id="recovering-from-a-degraded-state">
<h2>6.4. Восстановление после сбоя<a class="headerlink" href="#recovering-from-a-degraded-state" title="Ссылка на этот заголовок">¶</a></h2>
<p>&#8220;Сбой&#8221; — это ситуация, когда главный сервер становится недоступен вследствие проблем с оборудованием, сетевых неполадок или программной ошибки. У реплики нет способа автоматически обнаружить, что связь с главным сервером утеряна насовсем, поскольку причины сбоя и окружение, в котором развернута репликация, могут быть очень разными. Поэтому обнаруживать сбой должен человек.</p>
<p>However, once a master failure is detected, the recovery is simple: declare
that the replica is now the new master, by saying
<code class="extsamp docutils literal"><span class="pre">box.cfg{...</span> <span class="pre">listen=</span><em><span class="pre">URI</span></em> <span class="pre">...}</span></code>
Then, if there are updates on the old master that were not propagated before
the old master went down, they would have to be re-applied manually.</p>
</div>
<div class="section" id="quick-startup-of-a-new-simple-two-server-cluster">
<h2>6.5. Quick startup of a new simple two-server cluster<a class="headerlink" href="#quick-startup-of-a-new-simple-two-server-cluster" title="Ссылка на этот заголовок">¶</a></h2>
<p>Шаг 1. Запустите первый сервер со следующими настройками:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span><span class="n">box</span><span class="o">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="o">*</span><span class="n">uri</span><span class="c1">#1*}</span>
<span class="o">--</span> <span class="n">в</span> <span class="n">этом</span> <span class="n">запросе</span> <span class="n">можно</span> <span class="n">задать</span> <span class="n">больше</span> <span class="n">ограничений</span>
<span class="n">box</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">,</span> <span class="s1">&#39;read,write,execute&#39;</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>
</pre></div>
</div>
<p>... Итак, создался новый кластер.</p>
<p>Шаг 2. На втором сервере проверьте пути, по которым будут храниться файлы репликации. Эти пути задаются в параметрах <a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> (для .snap-файлов) и <a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> (для .xlog-файлов). В указанных директориях должно быть пусто, чтобы не случилось конфликта с теми начальными данными, что придут с первого сервера, когда второй сервер присоединится к кластеру.</p>
<p>Step 3. Запустите второй сервер со следующими настройками:</p>
<pre class="highlight literal-block">
box.cfg{
  listen = <em>uri#2</em>,
  replication_source = <em>uri#1</em>
}
</pre>
<p>... где <code class="docutils literal"><span class="pre">uri#1</span></code> = <a class="reference internal" href="../../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a>, на котором включено прослушивание у первого сервера.</p>
<p>Вот и всё.</p>
<p>В описанной выше конфигурации первый сервер выполняет роль &#8220;главного&#8221;, а второй служит &#8220;репликой&#8221;. Далее все изменения, происходящие на стороне главного сервера, будут доступны с реплики. Простой кластер из двух серверов, где главный сервер запущен на одном компьютере, а сервер-реплика — на другом, встречается очень часто и обладает двумя важными преимуществами: FAILOVER (т.е. отказоустойчивость, поскольку в случае отключения главного сервера его место может занять сервер-реплика) и LOAD BALANCING (т.е. балансировка нагрузки, поскольку клиенты могут обращаться с SELECT-запросами как к главному серверу, так и к реплике). При необходимости в настройках реплики можно задать параметр <a class="reference internal" href="../../reference/configuration/index.html#cfg-basic-read-only"><span class="std std-ref">read_only = true</span></a>.</p>
</div>
<div class="section" id="monitoring-a-replica-s-actions">
<span id="index-monitoring-replica-actions"></span><h2>6.6. Мониторинг действий реплики<a class="headerlink" href="#monitoring-a-replica-s-actions" title="Ссылка на этот заголовок">¶</a></h2>
<p>In <a class="reference internal" href="../box/box_info.html#box-introspection-box-info"><span class="std std-ref">box.info</span></a> there is a <code class="docutils literal"><span class="pre">box.info.replication.status</span></code> field:
&#8220;off&#8221;, &#8220;stopped&#8221;, &#8220;connecting&#8221;, &#8220;auth&#8221;, &#8220;follow&#8221;, or &#8220;disconnected&#8221;. <br />
If a replica&#8217;s status is &#8220;follow&#8221;, then there will be more fields &#8211;
the list is in the section <a class="reference internal" href="../box/box_info.html#box-introspection-box-info"><span class="std std-ref">Submodule box.info</span></a>.</p>
<p>В <a class="reference internal" href="../../reference/reference_lua/log.html#log"><span class="std std-ref">журнале</span></a> ведется запись о действиях, связанных с репликацией. Если главный сервер запущен со следующими настройками:</p>
<div class="highlight highlight-default"><div class="highlight"><pre><span></span><span class="n">box</span><span class="o">.</span><span class="n">cfg</span><span class="p">{</span>
  <span class="o">&lt;...&gt;</span><span class="p">,</span>
  <span class="n">logger</span> <span class="o">=</span> <span class="o">*</span><span class="n">имя_файла_для_ведения_журнала</span><span class="o">*</span><span class="p">,</span>
  <span class="o">&lt;...&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>то на каждую установку/потерю соединения реплики с главным сервером в журнале будут появляться строчки со словом &#8220;relay&#8221;.</p>
</div>
<div class="section" id="preventing-duplicate-actions">
<span id="index-preventing-duplicate-actions"></span><h2>6.7. Предотвращение дублирующихся действий<a class="headerlink" href="#preventing-duplicate-actions" title="Ссылка на этот заголовок">¶</a></h2>
<p>Предположим, что реплика пытается сделать нечто, что уже было сделано на главном сервере. Например: <br /> <code class="code docutils literal"><span class="pre">box.schema.space.create('X')</span></code> <br /> Это приведет к ошибке &#8220;Space X exists&#8221; (&#8220;Пространство X уже существует&#8221;). В данном частном случае можно скорректировать инструкцию следующим образом: <br /> <code class="code docutils literal"><span class="pre">box.schema.space.create('X',</span> <span class="pre">{if_not_exists=true})</span></code> <br /> Но существует и более общее решение: использовать метод <code class="samp docutils literal"><span class="pre">box.once(</span><em><span class="pre">key</span></em><span class="pre">,</span> <em><span class="pre">function</span></em><span class="pre">)</span></code>. Если <code class="code docutils literal"><span class="pre">box.once()</span></code> был вызван ранее с тем же значением параметра <code class="samp docutils literal"><em><span class="pre">key</span></em></code>, то функция <code class="samp docutils literal"><em><span class="pre">function</span></em></code> игнорируется; в противном случае функция <code class="samp docutils literal"><em><span class="pre">function</span></em></code> будет выполнена. Поэтому действия, которые должны совершаться только один раз за время текущей сессии репликации, нужно помещать в функцию и вызывать ее с помощью метода <code class="code docutils literal"><span class="pre">box.once()</span></code>. Например:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">f</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s1">&#39;space_creator&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="master-master-replication">
<h2>6.8. Репликация по схеме master-master<a class="headerlink" href="#master-master-replication" title="Ссылка на этот заголовок">¶</a></h2>
<p>В случае настройки репликации по схеме master-replica изменения на главном сервере доступны для просмотра с реплики, но не наоборот, потому как главный сервер в такой схеме указан в качестве единственного источника репликации. В случае схемы master-master (иногда ее также называет multi-master) просмотр изменений возможен в любом направлении. В простом случае (master-master с двумя серверами) на первом сервере нужно задать следующие настройки:</p>
<pre class="highlight literal-block">
box.cfg{ replication_source = <em>uri#2</em> }
</pre>
<p>Этот запрос можно выполнить в любой момент, т.к. параметр <a class="reference internal" href="../../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> можно задавать на ходу.</p>
<p>В данном примере оба сервера являются одновременно и &#8220;главными&#8221;, и &#8220;репликами&#8221;. Поэтому каждое изменение, которое случается на одном сервере, становится доступно для просмотра с другого сервера. Отказоустойчивость в такой конфигурации сохраняется, а возможности по балансировке нагрузки становятся еще шире (теперь клиенты могут обращаться к обоим серверам со всеми типами запросов — как на чтение данных, так и на изменение).</p>
<p>Если две операции над одним и тем же кортежем производятся &#8220;параллельно&#8221; (а это может потребовать много времени, поскольку репликация — это асинхронный процесс), причем одна из операций — это <code class="docutils literal"><span class="pre">delete</span></code>, а вторая — <code class="docutils literal"><span class="pre">replace</span></code>, то существует вероятность, что данные на серверах станут различаться.</p>
</div>
<div class="section" id="all-the-what-if-questions">
<h2>6.9. Ответы на вопросы &#8220;Что если?&#8221;<a class="headerlink" href="#all-the-what-if-questions" title="Ссылка на этот заголовок">¶</a></h2>
<div class="faq container">
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if there are more than two servers with master-master?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">On each server, specify the <a class="reference internal" href="../../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> for all the others. For example,
server #3 would have a request:</p>
<pre class="highlight literal-block">
box.cfg{ replication_source = {<em>uri1</em>}, {<em>uri2</em>} }
</pre>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if a server should be taken out of the cluster?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">For a replica, run <code class="docutils literal"><span class="pre">box.cfg{}</span></code> again specifying a blank replication
source: <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if a server leaves the cluster?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">The other servers carry on. If the wayward server rejoins, it will
receive all the updates that the other servers made while it was away.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if two servers both change the same tuple?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">The last changer wins. For example, suppose that server#1 changes the
tuple, then server#2 changes the tuple. In that case server#2&#8217;s change
overrides whatever server#1 did. In order to keep track of who came
last, Tarantool implements a <a class="reference external" href="https://en.wikipedia.org/wiki/Vector_clock">vector clock</a>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if two servers both insert the same tuple?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">If a master tries to insert a tuple which a replica has inserted
already, this is an example of a severe error. Replication stops.
It will have to be restarted manually.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if a master disappears and the replica must take over?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">A message will appear on the replica stating that the connection is
lost. The replica must now become independent, which can be done by
saying <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if it&#8217;s necessary to know what cluster a server is in?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">The identification of the cluster is a UUID which is generated when the
first master starts for the first time. This UUID is stored in a tuple
of the <a class="reference internal" href="../box/box_space.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a> system space. So to
see it, say: <code class="docutils literal"><span class="pre">box.space._schema:select{'cluster'}</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if it&#8217;s necessary to know what other servers belong in the cluster?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">The universal identification of a server is a UUID in
<code class="docutils literal"><span class="pre">box.info.server.uuid</span></code>. The ordinal identification of a server within
a cluster is a number in <code class="docutils literal"><span class="pre">box.info.server.id</span></code>. To see all the servers
in the cluster, say: <code class="docutils literal"><span class="pre">box.space._cluster:select{}</span></code>. This will return a
table with all {server.id, server.uuid} tuples for every server that has
ever joined the cluster.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if one of the server&#8217;s files is corrupted or deleted?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">Stop the server, destroy all the database files (the ones with extension
&#8220;snap&#8221; or &#8220;xlog&#8221; or &#8221;.inprogress&#8221;), restart the server, and catch up
with the master by contacting it again (just say
<code class="docutils literal"><span class="pre">box.cfg{...replication_source=...}</span></code>).</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if replication causes security concerns?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">Prevent unauthorized replication sources by associating a password with
every user that has access privileges for the relevant spaces, and every
user that has a replication <a class="reference internal" href="../box/authentication.html#authentication-roles"><span class="std std-ref">role</span></a>. That
way, the <a class="reference internal" href="../../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> for the <a class="reference internal" href="../../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> parameter will always have to have
the long form <code class="docutils literal"><span class="pre">replication_source='username:password&#64;host:port'</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">What if advanced users want to understand better how it all works?</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first last">See the description of server startup with replication in the
<a class="reference internal" href="../../dev_guide/internals_index.html#internals-replication"><span class="std std-ref">Internals</span></a> section.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="hands-on-replication-tutorial">
<h2>6.10. Практическое руководство по репликации<a class="headerlink" href="#hands-on-replication-tutorial" title="Ссылка на этот заголовок">¶</a></h2>
<p>Ниже приводятся пошаговые инструкции, которые помогут вам получить практический опыт администрирования кластера, а именно опыт создания кластера и добавления реплики.</p>
<p>Запустите два терминала, каждый в своем окне, и расположите их рядом на экране. (Далее в примерах оба терминала показаны в виде закладок. Щелкните на заголовок закладки — &#8220;Terminal #1&#8221; или &#8220;Terminal #2&#8221;, — чтобы увидеть вывод на соответствующем терминале.)</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-1">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-1-content">
<div class="b-documentation-tab container" id="terminal-1-1">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-1-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале (Terminal #1) выполните следующие команды:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_1/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>В результате были заданы настройки нового кластера, а на экране был выведен UUID текущего сервера. Теперь вывод на экране выглядит следующим образом (за тем исключением, что UUID у вас будут другие):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-2">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-2-content">
<div class="b-documentation-tab container" id="terminal-2-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">$</span> ~/tarantool/src/tarantool: version <span class="m">1</span>.7.0-1724-g033ed69
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="go">&lt;...&gt; I&gt; creating ./00000000000000000000.xlog.inprogress&#39;</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-2-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале (Terminal #2) выполните следующие команды:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ~/tarantool_test_node_2/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>В результате были заданы настройки сервера-реплики. На экране первого терминала (Terminal #1) появились сообщения с подтверждениями, что реплика установила соединение с главным сервером и что содержимое WAL-файла было отправлено на реплику. На экране второго терминала (Terminal #2) появились сообщения о том, что репликация начинается, а также там были выведены UUID из системного пространства _cluster (один из них совпадает с UUID в первом терминале, поскольку оба сервера входят в общий кластер).</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-3">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-3-content">
<div class="b-documentation-tab container" id="terminal-3-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-3-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале (Terminal #1) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-4">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-4-content">
<div class="b-documentation-tab container" id="terminal-4-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-4-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>В первом терминале успешно отработали операции CREATE и INSERT. Но во втором терминале ничего не произошло.</p>
<p>Во втором терминале (Terminal #2) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-5">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-5-content">
<div class="b-documentation-tab container" id="terminal-5-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-5-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале успешно отработали операции SELECT и INSERT. Но в первом терминале ничего не произошло.</p>
<p>В первом терминале (Terminal #1) выполните следующие запросы и команды:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> os.exit<span class="o">()</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">$</span> ls -l ~/tarantool_test_node_2
</pre></div>
</div>
<p>Теперь Tarantool-сервер в первом терминале остановлен. В окне второго терминала появились сообщения об этом событии. С помощью команд <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-l</span></code> мы убедились, что на обоих серверах создались файлы-снимки с одинаковыми размерами, поскольку там содержатся одни и те же кортежи.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-6">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-6-content">
<div class="b-documentation-tab container" id="terminal-6-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-6-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Во втором терминале (Terminal #2) проигнорируйте сообщения об ошибках и выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом (сообщения об ошибках мы не приводим):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-7">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-7-content">
<div class="b-documentation-tab container" id="terminal-7-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-7-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 coio.cc:352 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 6, aka 127.0.0.1:58734, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Запросы SELECT и INSERT во втором терминале отработали несмотря на то, что сервер в первом терминале остановлен.</p>
<p>В первом терминале (Terminal #1) выполните следующие запросы:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-8">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-8-content">
<div class="b-documentation-tab container" id="terminal-8-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;Tuple inserted on Terminal #1&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-8-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Главный сервер снова установил соединение с кластером и НЕ обнаружил изменения, сделанные репликой за время его недоступности. Это и не удивительно: мы же не просили реплику выступать в качестве источника репликации.</p>
<p>В первом терминале (Terminal #1) введите:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Теперь вывод на экране выглядит следующим образом:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-9">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-9-content">
<div class="b-documentation-tab container" id="terminal-9-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">[28987] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="go">[22612] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="go">[22612] main/101/interactive I&gt; set &#39;replication_source&#39; configuration</span>
<span class="go">        option to &quot;replicator:password@localhost:3302&quot;</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; connected to 1.7.0 at 127.0.0.1:3302</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; authenticated</span>
<span class="go">[22612] wal/101/main I&gt; creating `./00000000000000000008.xlog.inprogress&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; recover from `./00000000000000000008.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-9-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main recovery.cc:211 W&gt; file</span>
<span class="go">     `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
</div>
<script>
    register_replication_tab(1);
    register_replication_tab(2);
    register_replication_tab(3);
    register_replication_tab(4);
    register_replication_tab(5);
    register_replication_tab(6);
    register_replication_tab(7);
    register_replication_tab(8);
    register_replication_tab(9);
</script></div>
<p>Тут мы видим, что оба сервера снова синхронизовались и что каждый из них видит те записи, которые сделал другой.</p>
<p>Чтобы удалить все тестовые данные, выполните &#8220;<code class="docutils literal"><span class="pre">os.exit()</span></code>&#8221; на обоих терминалах, а затем на каждом из них выполните следующие команды:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> rm -R ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_2
</pre></div>
</div>
</div>
</div>

  </article>

            
            
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="../administration.html"
           class="b-prev b-ellipsis"
           title="5. Администрирование серверной части">5. Администрирование серверной части</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../../../_sources/doc/book/replication/index.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="../connectors/index.html"
           class="b-next b-ellipsis"
           title="7. Коннекторы">7. Коннекторы</a>
      </div>
    
    </div>
  
</div>
        </div>
      </div>
    
  

      </div>
    </div>
    <!-- FOOTER > -->
    
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../../index.html" class="b-menu-item-url">Main</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item p-cloud">
      
        <a href="https://tarantool.io/" class="b-menu-item-url">Cloud</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

    <!-- < FOOTER -->
    <div id="mobile-checker"></div>
  </body>
</html>

